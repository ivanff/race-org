<ActionBar [title]="'Athlets'|L">
    <NavigationButton icon="res://round_menu_black_24"
                      (tap)="onDrawerButtonTap()"></NavigationButton>
</ActionBar>
<GridLayout rows="auto, auto, *" columns="*">
    <StackLayout row="0" col="0">
        <SearchBar [hint]="'Search by full name or number'|L" [text]="searchPhrase"
                   (textChange)="onTextChanged($event)"
                   (submit)="onSubmit($event)"
                   (loaded)="searchBarLoaded($event)"></SearchBar>
    </StackLayout>
    <StackLayout row="1" col="0">
        <Button [text]="activityIndicator.busy ? ('Остановить поиск'|L) :('Найти по метке NFC'|L) "
                (tap)="(activityIndicator.busy = !activityIndicator.busy)"
                [class.-primary]="!activityIndicator.busy"
                row="0"
                col="0"
                class="btn">
        </Button>
        <StackLayout horizontalAlignment="center" [visibility]="activityIndicator.busy ? 'visible' : 'collapse'" verticalAlignment="center">
            <ActivityIndicator height="20"
                               width="20"
                               #activityIndicator
                               (busyChange)="onBusyChanged($event)"
                               style="color: red;"
                               verticalAlignment="center"
                               horizontalAlignment="center"
                               class="activity-indicator m-15"></ActivityIndicator>
        </StackLayout>
    </StackLayout>

    <ScrollView row="2" col="0">
        <ListView height="100%"
                  [items]="athlets|filter:['fio', 'number']:searchPhrase" style="line-height: 20px">
            <ng-template let-athlet="item" let-i="index" let-odd="odd" let-even="even">
                <GridLayout (tap)="onItemTap(athlet)" columns="60, *" rows="*, *, *, *, *">
                    <Label [text]="athlet.number" col="0" rowSpan="4" verticalAlignment="top" horizontalAlignment="center" class="number"></Label>
                    <Label [text]="athlet.class" col="0" row="5" class="option" horizontalAlignment="center"></Label>

                    <Label [text]="'Имя: ' + athlet.fio" col="1" row="0" class="option"></Label>
                    <Label [text]="'Город: ' + athlet.city" col="1" row="1" class="option"></Label>
                    <Label [text]="'Марка мотоцикла: ' + athlet.bike" col="1" row="2" class="option"></Label>
                    <Label [text]="'NFC: ' + (athlet.nfc_id ? 'назначено' : 'не назначено')" col="1" row="3" [class.warning]="!athlet.nfc_id" class="option"></Label>
                    <Label [text]="'Пройдено отметок: ' + athlet.checkpoints.length" col="1" row="4" class="font-weight-bold option"></Label>
                </GridLayout>
            </ng-template>
        </ListView>
    </ScrollView>
</GridLayout>
