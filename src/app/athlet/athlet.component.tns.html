<ActionBar [title]="'Athletes'|L">
    <NavigationButton icon="res://round_menu_black_24"
                      (tap)="onDrawerButtonTap()"></NavigationButton>
</ActionBar>
<GridLayout rows="auto, auto, *" columns="*">
    <StackLayout row="0" col="0">
        <SearchBar [hint]="'Search by full name or number'|L"
                   [text]="searchPhrase"
                   (textChange)="onTextChanged($event)"
                   (submit)="onSubmit($event)"
                   (loaded)="searchBarLoaded($event)" #searchBar></SearchBar>
    </StackLayout>
    <StackLayout row="1" col="0">
        <GridLayout columns="2*, *" rows="*,*">
            <Button row="0" col="0"
                    [colSpan]="_competition.selected_competition.checking.indexOf('barcode') > -1 ? 1 : 2"
                    [text]="activityIndicator.busy ? ('Search shop'|L) :('By NFC tag'|L) "
                    (tap)="(activityIndicator.busy = !activityIndicator.busy)"
                    [class.-primary]="!activityIndicator.busy"
                    class="btn">
            </Button>
            <Button row="0" col="1"
                    *ngIf="_competition.selected_competition.checking.indexOf('barcode') > -1"
                    (tap)="onScan()"
                    text="QR"
                    class="btn -grey">
            </Button>
            <StackLayout row="1" colSpan="2"
                         [visibility]="activityIndicator.busy ? 'visible' : 'collapse'"
                         horizontalAlignment="center"
                         verticalAlignment="center">
                <ActivityIndicator height="20"
                                   width="20"
                                   #activityIndicator
                                   (busyChange)="onBusyChanged($event)"
                                   style="color: red;"
                                   verticalAlignment="center"
                                   horizontalAlignment="center"
                                   class="activity-indicator m-15"></ActivityIndicator>
            </StackLayout>
        </GridLayout>
    </StackLayout>

    <StackLayout row="2" col="0">
        <RadListView [items]="athlets|filter:['fio', 'number']:{search: searchPhrase}"
                     height="100%"
                     class="items">
            <ng-template tkListItemTemplate let-athlet="item" let-i="index" let-odd="odd" let-even="even">
                <GridLayout (tap)="onItemTap(athlet)" columns="60, *" rows="*, *, *"
                            [class.odd]="odd"
                            [class.even]="even">
                    <Label [text]="athlet.number" col="0" rowSpan="2"
                           verticalAlignment="top"
                           horizontalAlignment="center" class="number"></Label>
                    <Label [text]="athlet.class" col="0" row="3" class="option" horizontalAlignment="center"></Label>

                    <Label [text]="('Name: '|L) + athlet.fio" col="1" row="0" class="option"></Label>
                    <Label [text]="'NFC: ' + (athlet.nfc_id ? ('assigned'|L) : ('not assigned'|L))" col="1" row="1"
                           [class.-warning]="!athlet.nfc_id" class="option font-weight-bold"></Label>
                    <Label [text]="('Passed marks: '|L) + athlet.marks.length" col="1" row="2"
                           class="font-weight-bold option"></Label>
                </GridLayout>
            </ng-template>
        </RadListView>
    </StackLayout>
</GridLayout>
