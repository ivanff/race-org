<mat-card class="m-20">
    <mat-card-content [hidden]="hide_start_time">
        <button (click)="onStart($event)" mat-raised-button color="primary" class="m-20">Начать соревнования</button>
        <ngx-timepicker-field #picker
                              [format]="24"
                              [defaultTime]="start_time.format('HH:mm')" class="m-20 in-row"></ngx-timepicker-field>
    </mat-card-content>
    <mat-card-content>
        <mat-form-field class="p-20">
            <input matInput (keyup)="applyFilter($event, 'str')" placeholder="Фильтр">
            <mat-hint>По фамилии или номеру участника</mat-hint>
        </mat-form-field>
        <div [hidden]="hide_class_filter" class="p-20 mat-form-field">
            <label id="radio-group-classes">Классы участников</label>
            <mat-radio-group [ngModel]="filter.class" (ngModelChange)="applyFilter($event, 'class')"
                             aria-labelledby="radio-group-classes" aria-label="Классы участников">
                <mat-radio-button class="m-r-10" value="">Все</mat-radio-button>
                <mat-radio-button class="m-r-10" value="open">Open</mat-radio-button>
                <mat-radio-button class="m-r-10" value="hobby">Hobby</mat-radio-button>
            </mat-radio-group>
        </div>
    </mat-card-content>
</mat-card>

<table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8">

    <ng-container *ngIf="!hide_place" matColumnDef="place">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Place</th>
        <td mat-cell *matCellDef="let element" [class.highlight]="element.place <= 3"> {{ element.place }} </td>
    </ng-container>

    <ng-container matColumnDef="number">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> No.</th>
        <td mat-cell *matCellDef="let element"><b>{{element.number}}</b></td>
    </ng-container>

    <ng-container matColumnDef="class">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Class</th>
        <td mat-cell *matCellDef="let element"> {{element.athlet.class}} </td>
    </ng-container>

    <ng-container matColumnDef="athlet">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Athlet</th>
        <td mat-cell *matCellDef="let element">
          <span>
             {{element.athlet.fio}}
          </span><br>
            <small>
                {{element.athlet.bike}}
            </small><br>
            <small>
                г. {{element.athlet.city}}
            </small>
            <small [hidden]="hide_start_time">
                <br>тел. {{element.athlet.phone}}
            </small>
        </td>
    </ng-container>

    <ng-container [matColumnDef]="def.key + '_' + y" *ngFor="let def of checkpoints; let y = index;">
        <th mat-header-cell *matHeaderCellDef class="v-top p-t-2" style="width: 70px">
        <span>
            {{ def.key }}
        </span><br>
            <small>
                {{ def.name }}
            </small>
        </th>
        <td mat-cell *matCellDef="let element" [ngSwitch]="!hide_place ? element.marks[y] : null">
      <span *ngSwitchDefault [class.active]="element.last_created == element.marks[y].created">
<!--        <mat-icon aria-hidden="false" aria-label="Clock">av_timer</mat-icon>-->
          <!--          {{ diffTime(element.marks[y].created) }}<br>-->
      <small>
          {{ diffTime(element.marks[y].created) }}
      </small>
        <small>
            {{ element.marks[y].created.toDate()|date:"HH:mm:ss" }}<br>
        </small>
      </span>
            <span *ngSwitchCase="null">-</span>
        </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
</table>
